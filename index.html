<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="A simple technique for the remote detection of user&#39;s antivirus  : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>A simple technique for the remote detection of user&#39;s antivirus </title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/vah13/AVDetection">View on GitHub</a>

          <h1 id="project_title">A simple technique for the remote detection of user&#39;s antivirus </h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/vah13/AVDetection/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/vah13/AVDetection/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>The operating system I often work with is windows 7, and to ensure greater safety, I installed Kaspersky Internet Security antivirus software. One day, looking through one of the web pages, I noticed a very interesting code, which in my opinion should not have been on the page.</p>

<p><img src="https://vah13.github.io/AVDetection/img/1.png" alt="facebook_kaspersky"></p>

<p>Why does Facebook use javascript code with Kaspersky website?. I immediately realized that my antivirus made MITM traffic  (http &amp; https), and injected its code to track the activity on the page. Hmmm, why not create a special page that will monitor the Javascript's scripts, and understand - have on the client computer any antivirus, include KIS.</p>

<p>Create on the server first page - iframe.html </p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head/&gt;
        &lt;img src=x /&gt;
    &lt;script type="text/javascript" /&gt;

&lt;/html&gt;
</code></pre>

<p>and after create second page - index.html with this HTML code</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Remotely  AV detection&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;iframe style="width:10px; height:10px; display:block; visibility:show" id="frmin" src="/iframe.html"&gt;&lt;/iframe&gt;
&lt;button onclick="myFunction()"&gt;Check  AV&lt;/button&gt;
&lt;script&gt;
function myFunction() {
var frm = document.getElementById("frmin");
ka = frm.contentDocument.getElementsByTagName('html')[0].outerHTML;
if (ka.indexOf("kasperskylab_antibanner") !== -1)
{
        alert("AV name is Kaspersky");
}
}

&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>When we open index.html page, it will load iframe.html and inject JS code. In this img we can see changed iframe page code
<img src="https://vah13.github.io/AVDetection/img/2.png" alt="kasperskylab_antibanner"></p>

<p>great, to detect, KIS antivirus needs to get code from iframe.html page and parse strings, if the page has <strong>kasperskylab_antibanner</strong> then we can say - the client computer has installed KIS antivirus.</p>

<p>I wanted to see how things will pan out from other antivirus software if other anti-virus software to detect, or only KIS. Next, consider Avira, Norton, DrWeb antivirus, if anyone wants to continue this mini study, I will be glad to hear about the rest of it works.</p>

<p>Antivirus Avira, Norton, DrWeb, together with the installation of the system, for the chrome browser, install and even add-ons which are as of injectate to the page specific data which can be Oh detectit.</p>

<h3>
<a id="drweb" class="anchor" href="#drweb" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Dr.Web</strong>
</h3>

<p>Product version DrWeb Security Space 11.0</p>

<p><img src="https://vah13.github.io/AVDetection/img/3.png" alt="dr.web version"></p>

<p>Chrome extension name s - Dr.Web Anti-Virus Link Checker
Extension URL</p>

<p><a href="https://chrome.google.com/webstore/detail/drweb-anti-virus-link-che/aleggpabliehgbeagmfhnodcijcmbonb?hl=en-US">https://chrome.google.com/webstore/detail/drweb-anti-virus-link-che/aleggpabliehgbeagmfhnodcijcmbonb?hl=en-US</a>
On the index.html page injected follow code </p>

<p><img src="https://vah13.github.io/AVDetection/img/4.png" alt="dr.web_JS"></p>

<p>i.e. using the following simple JS code can be found installed DrWeb us or not.</p>

<pre><code>&lt;script&gt;
if (document.getElementsByClassName('drweb_btn').length &gt; 0)
{
        alert("AV name is DrWeb");
}
&lt;/script&gt;
</code></pre>

<h3>
<a id="avira" class="anchor" href="#avira" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Avira</strong>
</h3>

<p>When installing Avira antivirus Pro, it installed 2 extensions in the Chrome browser
Avira Browser Safety and Avira Save Search Plus</p>

<p><img src="https://vah13.github.io/AVDetection/img/5.png" alt="avira"></p>

<p>Avira on the page index.html injected iframe which has the following form</p>

<p><img src="https://vah13.github.io/AVDetection/img/6.png" alt="avira_JS"></p>

<p>and it turns out JS code for detect Avira extension is as follows</p>

<pre><code>var AV = document.getElementById("abs-top-frame")
if (AV!==null)
{
if ( 
AV.outerHTML.indexOf('/html/top.html')&gt;=0 &amp; AV.outerHTML.indexOf('chrome-extension://')&gt;=0 
)
{
    alert("AV name is Avira");
}
}
</code></pre>

<h3>
<a id="norton" class="anchor" href="#norton" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Norton</strong>
</h3>

<p>And finally the last extension to AV which I had to consider - Norton
He has installed, like Avira, 2 extension</p>

<p><img src="https://vah13.github.io/AVDetection/img/7.png" alt="norton"></p>

<p>JS code which is implemented by the extension on the page as follows</p>

<p><img src="https://vah13.github.io/AVDetection/img/8.png" alt="avira"></p>

<p>and in the end, it turned out that it is also very easy to detected using this JS code</p>

<pre><code>var NAV = document.getElementById('coFrameDiv');
if ( NAV !== null)
{
    var nort = NAV.outerHTML;
    if (nort.indexOf('coToolbarFrame')&gt;=0 &amp; nort.indexOf('/toolbar/placeholder.html')&gt;=0 &amp; nort.indexOf('chrome-extension://')&gt;=0 )
    {
        alert("AV name is Norton");
    }
}
</code></pre>

<h3>
<a id="conclusion" class="anchor" href="#conclusion" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Conclusion</h3>

<ol>
<li>This method does not guarantee 100% detection AV, as it is based on verification of the installed anti-virus extension for Chrome which can be disabled by the user.</li>
<li>The main idea for the writing of this mini article came after reading this article <a href="http://agrrrdog.blogspot.ru/2016/06/remote-detection-of-users-av-via-flash.html">remote-detection-of-users-av-via-flash</a>
</li>
<li>Code of this project can found <a href="https://github.com/vah13/AVDetection">AVDetection</a>
</li>
</ol>

<p><a href="https://twitter.com/vah_13">@vah_13</a></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">A simple technique for the remote detection of user&#39;s antivirus  maintained by <a href="https://github.com/vah13">vah13</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
